!function(){"use strict";const t=Math.pow(2,-52),e=new Uint32Array(512);class n{static from(t,e=c,s=u){const i=t.length,r=new Float64Array(2*i);for(let n=0;n<i;n++){const i=t[n];r[2*n]=e(i),r[2*n+1]=s(i)}return new n(r)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:e,_hullPrev:n,_hullNext:i,_hullTri:o,_hullHash:l}=this,c=e.length>>1;let u=1/0,d=1/0,f=-1/0,g=-1/0;for(let t=0;t<c;t++){const n=e[2*t],s=e[2*t+1];n<u&&(u=n),s<d&&(d=s),n>f&&(f=n),s>g&&(g=s),this._ids[t]=t}const p=(u+f)/2,_=(d+g)/2;let y,w,b,m=1/0;for(let t=0;t<c;t++){const n=s(p,_,e[2*t],e[2*t+1]);n<m&&(y=t,m=n)}const I=e[2*y],v=e[2*y+1];m=1/0;for(let t=0;t<c;t++){if(t===y)continue;const n=s(I,v,e[2*t],e[2*t+1]);n<m&&n>0&&(w=t,m=n)}let M=e[2*w],A=e[2*w+1],k=1/0;for(let t=0;t<c;t++){if(t===y||t===w)continue;const n=a(I,v,M,A,e[2*t],e[2*t+1]);n<k&&(b=t,k=n)}let D=e[2*b],x=e[2*b+1];if(k===1/0){for(let t=0;t<c;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];h(this._ids,this._dists,0,c-1);const t=new Uint32Array(c);let n=0;for(let e=0,s=-1/0;e<c;e++){const i=this._ids[e];this._dists[i]>s&&(t[n++]=i,s=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(r(I,v,M,A,D,x)){const t=w,e=M,n=A;w=b,M=D,A=x,b=t,D=e,x=n}const E=function(t,e,n,s,i,r){const o=n-t,a=s-e,h=i-t,l=r-e,c=o*o+a*a,u=h*h+l*l,d=.5/(o*l-a*h);return{x:t+(l*c-a*u)*d,y:e+(o*u-h*c)*d}}(I,v,M,A,D,x);this._cx=E.x,this._cy=E.y;for(let t=0;t<c;t++)this._dists[t]=s(e[2*t],e[2*t+1],E.x,E.y);h(this._ids,this._dists,0,c-1),this._hullStart=y;let L=3;i[y]=n[b]=w,i[w]=n[y]=b,i[b]=n[w]=y,o[y]=0,o[w]=1,o[b]=2,l.fill(-1),l[this._hashKey(I,v)]=y,l[this._hashKey(M,A)]=w,l[this._hashKey(D,x)]=b,this.trianglesLen=0,this._addTriangle(y,w,b,-1,-1,-1);for(let s,a,h=0;h<this._ids.length;h++){const c=this._ids[h],u=e[2*c],d=e[2*c+1];if(h>0&&Math.abs(u-s)<=t&&Math.abs(d-a)<=t)continue;if(s=u,a=d,c===y||c===w||c===b)continue;let f=0;for(let t=0,e=this._hashKey(u,d);t<this._hashSize&&(f=l[(e+t)%this._hashSize],-1===f||f===i[f]);t++);f=n[f];let g,p=f;for(;g=i[p],!r(u,d,e[2*p],e[2*p+1],e[2*g],e[2*g+1]);)if(p=g,p===f){p=-1;break}if(-1===p)continue;let _=this._addTriangle(p,c,i[p],-1,-1,o[p]);o[c]=this._legalize(_+2),o[p]=_,L++;let m=i[p];for(;g=i[m],r(u,d,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)_=this._addTriangle(m,c,g,o[c],-1,o[m]),o[c]=this._legalize(_+2),i[m]=m,L--,m=g;if(p===f)for(;g=n[p],r(u,d,e[2*g],e[2*g+1],e[2*p],e[2*p+1]);)_=this._addTriangle(g,c,p,-1,o[p],o[g]),this._legalize(_+2),o[g]=_,i[p]=p,L--,p=g;this._hullStart=n[c]=p,i[p]=n[m]=c,i[c]=m,l[this._hashKey(u,d)]=c,l[this._hashKey(e[2*p],e[2*p+1])]=p}this.hull=new Uint32Array(L);for(let t=0,e=this._hullStart;t<L;t++)this.hull[t]=e,e=i[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:s,coords:i}=this;let r=0,a=0;for(;;){const h=s[t],l=t-t%3;if(a=l+(t+2)%3,-1===h){if(0===r)break;t=e[--r];continue}const c=h-h%3,u=l+(t+1)%3,d=c+(h+2)%3,f=n[a],g=n[t],p=n[u],_=n[d];if(o(i[2*f],i[2*f+1],i[2*g],i[2*g+1],i[2*p],i[2*p+1],i[2*_],i[2*_+1])){n[t]=_,n[h]=f;const i=s[d];if(-1===i){let e=this._hullStart;do{if(this._hullTri[e]===d){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i),this._link(h,s[a]),this._link(a,d);const o=c+(h+1)%3;r<e.length&&(e[r++]=o)}else{if(0===r)break;t=e[--r]}}return a}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,n,s,i,r){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=e,this._triangles[o+2]=n,this._link(o,s),this._link(o+1,i),this._link(o+2,r),this.trianglesLen+=3,o}}function s(t,e,n,s){const i=t-n,r=e-s;return i*i+r*r}function i(t,e,n,s,i,r){const o=(s-e)*(i-t),a=(n-t)*(r-e);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function r(t,e,n,s,r,o){return(i(r,o,t,e,n,s)||i(t,e,n,s,r,o)||i(n,s,r,o,t,e))<0}function o(t,e,n,s,i,r,o,a){const h=t-o,l=e-a,c=n-o,u=s-a,d=i-o,f=r-a,g=c*c+u*u,p=d*d+f*f;return h*(u*p-g*f)-l*(c*p-g*d)+(h*h+l*l)*(c*f-u*d)<0}function a(t,e,n,s,i,r){const o=n-t,a=s-e,h=i-t,l=r-e,c=o*o+a*a,u=h*h+l*l,d=.5/(o*l-a*h),f=(l*c-a*u)*d,g=(o*u-h*c)*d;return f*f+g*g}function h(t,e,n,s){if(s-n<=20)for(let i=n+1;i<=s;i++){const s=t[i],r=e[s];let o=i-1;for(;o>=n&&e[t[o]]>r;)t[o+1]=t[o--];t[o+1]=s}else{let i=n+1,r=s;l(t,n+s>>1,i),e[t[n]]>e[t[s]]&&l(t,n,s),e[t[i]]>e[t[s]]&&l(t,i,s),e[t[n]]>e[t[i]]&&l(t,n,i);const o=t[i],a=e[o];for(;;){do{i++}while(e[t[i]]<a);do{r--}while(e[t[r]]>a);if(r<i)break;l(t,i,r)}t[n+1]=t[r],t[r]=o,s-i+1>=r-n?(h(t,e,i,s),h(t,e,n,r-1)):(h(t,e,n,r-1),h(t,e,i,s))}}function l(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function c(t){return t[0]}function u(t){return t[1]}function d(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class f{constructor(t,[e,s,i,r]){if(!((i=+i)>=(e=+e)&&(r=+r)>=(s=+s)))throw new Error("invalid bounds");this.points=t,this.delaunator=new n(t),this.inedges=new Int32Array(t.length/2),this.hullIndex=new Int32Array(t.length/2),this.init()}update(){this.delaunator.update(),this.init()}find(t,e,n=0){if((t=+t)!=t||(e=+e)!=e)return-1;const s=n;let i;for(;(i=this.step(n,t,e))>=0&&i!==n&&i!==s;)n=i;return i}init(){const t=this.delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:n}=t;for(let t=0;t<e.length;t+=3){const s=2*e[t],i=2*e[t+1],r=2*e[t+2];if((n[r]-n[s])*(n[i+1]-n[s+1])-(n[i]-n[s])*(n[r+1]-n[s+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},(t,e)=>e).sort((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]);const t=this.collinear[0],s=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*s],e[2*s+1]],r=1e-8*Math.sqrt((i[3]-i[1])**2+(i[2]-i[0])**2);for(let t=0,n=e.length/2;t<n;++t){const n=d(e[2*t],e[2*t+1],r);e[2*t]=n[0],e[2*t+1]=n[1]}this.delaunator=new n(e)}else delete this.collinear;const s=this.halfedges=this.delaunator.halfedges,i=this.hull=this.delaunator.hull,r=this.triangles=this.delaunator.triangles,o=this.inedges.fill(-1),a=this.hullIndex.fill(-1);for(let t=0,e=s.length;t<e;++t){const e=r[t%3==2?t-2:t+1];-1!==s[t]&&-1!==o[e]||(o[e]=t)}for(let t=0,e=i.length;t<e;++t)a[i[t]]=t;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],o[i[0]]=1,2===i.length&&(o[i[1]]=0))}step(t,e,n){const{inedges:s,hullIndex:i,points:r}=this,o=this.triangles,a=this.halfedges,h=this.hull;if(-1===s[t]||!r.length)return(t+1)%(r.length>>1);let l=t,c=(e-r[2*t])**2+(n-r[2*t+1])**2;const u=s[t];let d=u;do{const s=o[d],u=(e-r[2*s])**2+(n-r[2*s+1])**2;if(u<c&&(c=u,l=s),d=d%3==2?d-2:d+1,o[d]!==t)break;if(d=a[d],-1===d){if(d=h[(i[t]+1)%h.length],d!==s&&(e-r[2*d])**2+(n-r[2*d+1])**2<c)return d;break}}while(d!==u);return l}}function g(t,e){const n=4*t;return 1-(.299*e[n]+.587*e[n+1]+.114*e[n+2])/254}let p,_;const y=new WeakMap,w=new WeakMap,b=new WeakMap,m=new WeakMap,I=new WeakMap;let v={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return w.get(t);if("objectStoreNames"===e)return t.objectStoreNames||b.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return k(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function M(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(_||(_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(D(this),e),k(y.get(this))}:function(...e){return k(t.apply(D(this),e))}:function(e,...n){const s=t.call(D(this),e,...n);return b.set(s,e.sort?e.sort():[e]),k(s)}}function A(t){return"function"==typeof t?M(t):(t instanceof IDBTransaction&&function(t){if(w.has(t))return;const e=new Promise((e,n)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",r),t.removeEventListener("abort",r)},i=()=>{e(),s()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",r),t.addEventListener("abort",r)});w.set(t,e)}(t),e=t,(p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,v):t);var e}function k(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",r)},i=()=>{e(k(t.result)),s()},r=()=>{n(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",r)});return e.then(e=>{e instanceof IDBCursor&&y.set(e,t)}).catch(()=>{}),I.set(e,t),e}(t);if(m.has(t))return m.get(t);const e=A(t);return e!==t&&(m.set(t,e),I.set(e,t)),e}const D=t=>I.get(t);const x=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],L=new Map;function S(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(L.get(e))return L.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=E.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!i&&!x.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,i?"readwrite":"readonly");let o=r.store;s&&(o=o.index(e.shift()));const a=await o[n](...e);return i&&await r.done,a};return L.set(e,r),r}!function(t){v=t(v)}(t=>({...t,get:(e,n,s)=>S(e,n)||t.get(e,n,s),has:(e,n)=>!!S(e,n)||t.has(e,n)}));class B{async initialize(){try{this.db=await function(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=k(o);return s&&o.addEventListener("upgradeneeded",t=>{s(k(o.result),t.oldVersion,t.newVersion,k(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(t=>{r&&t.addEventListener("close",()=>r()),i&&t.addEventListener("versionchange",()=>i())}).catch(()=>{}),a}("stipplings",1,{upgrade(t,e){e||t.createObjectStore("stippled-images",{keyPath:"url"})}})}catch(t){console.error(t)}}async addInfo(t,e){this.db&&this.db.put("stippled-images",Object.assign({url:t},e))}async getInfo(t){return this.db&&await this.db.get("stippled-images",t)||null}}let q;async function T(){return q||(q=new B),await q.initialize(),q}let R="";const z=t=>{self.postMessage(t)},P=new class{constructor(t){this.callback=t}process(t){this.currentRequest?this.pendingRequest=t:(this.pendingRequest=void 0,this.currentRequest=t,this.stipple())}pushPending(){return!!this.pendingRequest&&(this.currentRequest=this.pendingRequest,this.pendingRequest=void 0,setTimeout(()=>this.stipple()),!0)}stipple(){if(!this.currentRequest)return;const{pointCount:t,width:e,height:n,buffer:s}=this.currentRequest,i=this.currentRequest.iterations||[40],r=t||e*n/50,o=Math.max(...i),a=new Float32Array(2*r),h=new Uint8ClampedArray(s),l=new Float64Array(2*r),c=new Float64Array(r);for(let t=0;t<r;++t)for(let s=0;s<60;++s){const s=a[2*t]=Math.floor(Math.random()*e),i=a[2*t+1]=Math.floor(Math.random()*n);if(Math.random()<g(i*e+s,h))break}if(this.pushPending())return;const u=new f(a,[0,0,e,n]);for(let t=0;t<=o;++t){if(this.pushPending())return;l.fill(0),c.fill(0);for(let t=0,s=0;t<n;++t)for(let n=0;n<e;++n){const i=g(t*e+n,h);s=u.find(n+.5,t+.5,s),c[s]+=i,l[2*s]+=i*(n+.5),l[2*s+1]+=i*(t+.5)}const s=10*Math.pow(t+1,-.8);for(let t=0;t<r;++t){const e=a[2*t],n=a[2*t+1],i=c[t]?l[2*t]/c[t]:e,r=c[t]?l[2*t+1]/c[t]:n;a[2*t]=e+1.8*(i-e)+(Math.random()-.5)*s,a[2*t+1]=n+1.8*(r-n)+(Math.random()-.5)*s}u.update(),i.indexOf(t)>=0&&this.callback({points:a,width:e,height:n,iteration:t})}this.currentRequest=void 0,this.pushPending()}}(async t=>{if(z(t),R&&50===t.iteration)try{const e=R;(await T()).addInfo(e,t)}catch(t){}});self.addEventListener("message",async t=>{const e=t.data;try{const t=await(await T()).getInfo(e.name);if(t)return void z(t)}catch(t){}R=e.name,e.iterations||(e.iterations=[2,5,10,15,20,30,40,50]),P.process(e)})}();
